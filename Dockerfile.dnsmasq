# 使用最新的轻量级 Alpine 镜像
FROM alpine:latest

# 安装 dnsmasq
# --no-cache 可以减小镜像体积，不在本地存储索引文件
RUN apk add --no-cache dnsmasq

# 创建配置存放目录（如果需要存放额外的自定义配置）
RUN mkdir -p /etc/dnsmasq.d

# 暴露 DNS (53) 和 DHCP (67) 端口
# DNS 使用 TCP 和 UDP
EXPOSE 53/tcp 53/udp 67/udp

# 启动命令
# --keep-in-foreground: 必须设置，否则容器启动后会立即退出
# --log-facility=-: 将日志输出到 stdout，方便 docker logs 查看
# --user=root: 某些环境下运行 DHCP 需要 root 权限
ENTRYPOINT ["dnsmasq", "--keep-in-foreground", "--log-facility=-"]
